<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoWallet Pro | Dashboard</title>
    
    <!-- 外部依赖 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 项目共享样式 (替换原来内联的<style>标签) -->
    <link rel="stylesheet" href="common/css/shared.css">
    
    <!-- 仪表板页面特定样式 (只保留dashboard独有的样式) -->
    <style>
        /* Dashboard特有布局 (不影响其他页面) */
        .dashboard-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .balance-cards {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1200px) {
            .balance-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .balance-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .balance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .balance-label {
            color: #64748b;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }
        
        .balance-amount {
            font-size: 40px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(to right, #0ea5e9, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .actions-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .actions-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .actions-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .action-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .market-table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .activities-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1200px) {
            .activities-container {
                grid-template-columns: 1fr;
            }
        }
        
        .activity-section {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* 其他dashboard特有样式... */
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- 侧边栏 (与common/shared.css中的样式匹配) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="logo-text">CryptoWallet Pro</div>
                </div>
            </div>

            <div class="user-profile">
                <div class="avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">Alex Johnson</div>
                    <div class="user-email">alex@cryptowallet.com</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <ul>
                    <!-- 注意：每个li的id必须与common/js/sidebar.js中的映射匹配 -->
                    <li class="nav-item" id="nav-dashboard">
                        <a href="dashboard.html" class="nav-link">
                            <i class="fas fa-home"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item" id="nav-account">
                        <a href="account.html" class="nav-link">
                            <i class="fas fa-user-circle"></i>
                            <span class="nav-text">My Account</span>
                        </a>
                    </li>
                    <li class="nav-item" id="nav-profile">
                        <a href="profile.html" class="nav-link">
                            <i class="fas fa-id-card"></i>
                            <span class="nav-text">Profile</span>
                        </a>
                    </li>
                    <li class="nav-item" id="nav-inbox">
                        <a href="inbox.html" class="nav-link">
                            <i class="fas fa-inbox"></i>
                            <span class="nav-text">Inbox</span>
                            <span class="nav-badge">3</span>
                        </a>
                    </li>
                    <li class="nav-item" id="nav-deposit">
                        <a href="deposit-withdraw.html" class="nav-link">
                            <i class="fas fa-exchange-alt"></i>
                            <span class="nav-text">Deposit & Withdraw</span>
                        </a>
                    </li>
                    <li class="nav-item" id="nav-transactions">
                        <a href="transactions.html" class="nav-link">
                            <i class="fas fa-history"></i>
                            <span class="nav-text">Transactions</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="top-bar">
                <div class="top-bar-left">
                    <div class="page-title">
                        <h1 id="dashboardTitle">Wallet Dashboard</h1>
                        <p class="page-subtitle" id="dashboardSubtitle">Welcome back! Here's your financial overview</p>
                    </div>
                </div>
                
                <div class="top-bar-right">
                    <div class="language-switcher">
                        <button class="lang-btn active" data-lang="en">EN</button>
                        <button class="lang-btn" data-lang="cn">中文</button>
                    </div>
                    
                    <div class="user-menu">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-dropdown">
                            <span class="user-email">alex@cryptowallet.com</span>
                        </div>
                    </div>
                    
                    <button class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <!-- 仪表板具体内容 (你原有的所有内容保持不变) -->
            <div class="dashboard-content">
                <!-- Balance Section -->
                <div class="balance-section">
                    <div class="section-header">
                        <h2 class="section-title" id="totalBalanceText">Total Balance</h2>
                        <div class="balance-actions">
                            <button class="refresh-btn" id="refreshBalance">
                                <i class="fas fa-sync-alt"></i> <span id="refreshText">Refresh</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="balance-cards">
                        <div class="balance-card main">
                            <div class="balance-header">
                                <span class="balance-label">
                                    <i class="fas fa-coins"></i> <span id="totalAssetsText">Total Assets (USD)</span>
                                </span>
                                <div class="trend-indicator positive">
                                    <i class="fas fa-arrow-up"></i> 12.5% today
                                </div>
                            </div>
                            <div class="balance-amount" id="totalBalanceAmount">$ 0.00</div>
                            <div class="balance-change">
                                <span class="change-amount positive" id="dailyChange">+$ 0.00</span>
                                <span class="change-period" id="changePeriodText">(24h change)</span>
                            </div>
                            <!-- Cash Balance Display -->
                            <div class="cash-balance-display" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <span style="color: #64748b; font-size: 14px;">
                                        <i class="fas fa-money-bill-wave"></i> Account Cash Balance (USD)
                                    </span>
                                    <span style="font-weight: 600; color: #10b981;" id="cashBalanceAmount">
                                        $50,000.00
                                    </span>
                                </div>
                                <small style="color: #64748b; font-size: 12px;">Available for trading and withdrawals</small>
                            </div>
                        </div>
                        
                        <div class="balance-card secondary">
                            <div class="coin-assets-header">
                                <span class="balance-label">
                                    <i class="fas fa-wallet"></i> <span id="coinAssetsText">Coin Assets</span>
                                </span>
                                <div class="view-all-assets" id="viewAllAssets">
                                    <i class="fas fa-chevron-right"></i> <span id="viewAllText">View All</span>
                                </div>
                            </div>
                            <div class="asset-list" id="coinAssetsList">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i> <span id="loadingAssetsText">Loading assets...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="balance-card secondary">
                            <div class="balance-header">
                                <span class="balance-label">
                                    <i class="fas fa-dollar-sign"></i> <span id="usdtBalanceText">USDT Balance</span>
                                </span>
                                <i class="fab fa-usd"></i>
                            </div>
                            <div class="balance-amount" id="usdtBalance">0.00 USDT</div>
                            <div class="balance-value" id="usdtValue">≈ $ 0.00</div>
                            <div class="balance-change">
                                <span class="change-amount positive" id="usdtChange">+$ 0.00</span>
                                <span class="change-period" id="usdtChangePeriod">(24h change)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Wallet Actions -->
                <div class="actions-section">
                    <div class="section-header">
                        <h2 class="section-title" id="walletActionsText">Wallet Actions</h2>
                        <p class="section-subtitle" id="walletSubtitle">Send, receive or manage your funds</p>
                    </div>
                    
                    <div class="actions-cards">
                        <div class="action-card send">
                            <div class="action-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <h3 class="action-title" id="sendText">Send</h3>
                            <p class="action-desc" id="sendDesc">Send crypto to another wallet address</p>
                            <div class="send-input-group">
                                <input type="text" class="send-input" id="sendAddress" placeholder="Paste wallet address here...">
                                <button class="send-btn" id="sendCrypto">
                                    <i class="fas fa-paper-plane"></i> <span id="sendNowText">Send Now</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="action-card receive">
                            <div class="action-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <h3 class="action-title" id="receiveText">Receive</h3>
                            <p class="action-desc" id="receiveDesc">Generate your wallet address for receiving funds</p>
                            <button class="action-btn" id="generateWalletLink">
                                <i class="fas fa-link"></i> <span id="generateAddressText">Generate Address</span>
                            </button>
                            <div class="wallet-link-container">
                                <div class="wallet-link-display" id="walletLinkDisplay">
                                    <span id="clickGenerateText">Click "Generate Address" above</span>
                                </div>
                                <button class="copy-btn" id="copyWalletLink" title="Copy to clipboard">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="action-card exchange">
                            <div class="action-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <h3 class="action-title" id="exchangeText">Exchange</h3>
                            <p class="action-desc" id="exchangeDesc">Swap between cryptocurrencies instantly</p>
                            <button class="action-btn" id="exchangeBtn">
                                <i class="fas fa-sync-alt"></i> <span id="exchangeNowText">Exchange Now</span>
                            </button>
                        </div>
                        
                        <div class="action-card stake">
                            <div class="action-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3 class="action-title" id="stakeText">Stake & Earn</h3>
                            <p class="action-desc" id="stakeDesc">Earn rewards by staking your cryptocurrencies</p>
                            <button class="action-btn" id="stakeBtn">
                                <i class="fas fa-percentage"></i> <span id="startEarningText">Start Earning</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Market Overview -->
                <div class="market-section">
                    <div class="section-header">
                        <div class="header-left">
                            <h2 class="section-title" id="marketOverviewText">Market Overview</h2>
                            <div class="market-filters">
                                <button class="filter-btn active" data-filter="all" id="filterAllText">All</button>
                                <button class="filter-btn" data-filter="gainers" id="filterGainersText">Gainers</button>
                                <button class="filter-btn" data-filter="losers" id="filterLosersText">Losers</button>
                            </div>
                        </div>
                        <div class="header-right">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="marketSearch" placeholder="Search cryptocurrencies...">
                            </div>
                            <div class="refresh-info">
                                <i class="fas fa-clock"></i>
                                <span id="lastUpdated">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="market-table-container">
                        <table class="market-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="market_cap">
                                        <span id="assetColumnText">Asset</span> <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="current_price">
                                        <span id="priceColumnText">Price (USD)</span> <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="price_change_percentage_24h">
                                        <span id="change24hText">24h Change</span> <i class="fas fa-sort"></i>
                                    </th>
                                    <th><span id="marketCapText">Market Cap</span></th>
                                    <th><span id="volume24hText">24h Volume</span></th>
                                    <th><span id="actionColumnText">Action</span></th>
                                </tr>
                            </thead>
                            <tbody id="marketTableBody">
                                <tr>
                                    <td colspan="6" class="loading-spinner">
                                        <i class="fas fa-spinner fa-spin"></i> <span id="loadingMarketDataText">Loading live market data...</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination" id="marketPagination">
                        <button class="page-btn" id="prevPage" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="page-info" id="pageInfo">Page 1</span>
                        <button class="page-btn" id="nextPage">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Recent Activity & Pending Transactions -->
                <div class="activities-container">
                    <!-- Recent Activity -->
                    <div class="activity-section">
                        <div class="section-header">
                            <h2 class="section-title" id="recentActivityText">Recent Activity</h2>
                            <a href="#" class="view-all" id="viewAllActivity">
                                <span id="viewAllActivityText">View All</span> <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                        
                        <div class="activity-list" id="recentActivityList">
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                                <div class="activity-details">
                                    <div class="activity-title">Received Bitcoin</div>
                                    <div class="activity-meta">From: 0x1a2b...3c4d • 2 hours ago</div>
                                </div>
                                <div class="activity-amount positive">+0.05 BTC</div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon sent">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div class="activity-details">
                                    <div class="activity-title">Sent Ethereum</div>
                                    <div class="activity-meta">To: 0x5e6f...7g8h • 5 hours ago</div>
                                </div>
                                <div class="activity-amount negative">-2.1 ETH</div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                <div class="activity-details">
                                    <div class="activity-title">Exchange Completed</div>
                                    <div class="activity-meta">BTC → ETH • Yesterday</div>
                                </div>
                                <div class="activity-amount neutral">Exchange</div>
                            </div>
                            
                            <div class="activity-item">
                                <div class="activity-icon success">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="activity-details">
                                    <div class="activity-title">Staking Rewards</div>
                                    <div class="activity-meta">ADA Staking • 2 days ago</div>
                                </div>
                                <div class="activity-amount positive">+42.5 ADA</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pending List -->
                    <div class="activity-section">
                        <div class="section-header">
                            <h2 class="section-title" id="pendingTransactionsText">Pending Transactions</h2>
                            <span class="pending-count" id="pendingCount">0 pending</span>
                        </div>
                        
                        <div class="activity-list" id="pendingList">
                            <div class="empty-state">
                                <i class="fas fa-clock"></i>
                                <p><span id="noPendingText">No pending transactions</span></p>
                                <small><span id="pendingInstructionsText">Transactions will appear here waiting for approval</span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- 共享JavaScript (替换原来重复的通用函数) -->
    <script src="common/js/sidebar.js"></script>
    <script src="common/js/utils.js"></script>
    
    <!-- Dashboard页面特定的JavaScript (你原有的所有业务逻辑保持不变) -->
    <script>
        // ==================== GLOBAL STATE ====================
        let marketData = [];
        let filteredMarketData = [];
        let userAssets = [];
        let pendingTransactions = [];
        let recentActivities = [];
        let cashBalance = 50000.00;
        let refreshInterval;
        let currentPage = 1;
        const coinsPerPage = 10;
        let currentLanguage = 'en';
        
        // Translation data (保持不变)
        const translations = {
            en: {
                // ... 你原有的所有翻译文本 ...
            },
            cn: {
                // ... 你原有的所有翻译文本 ...
            }
        };
        
        // CoinGecko API endpoints (保持不变)
        const COINGECKO_API = {
            MARKET_DATA: 'https://api.coingecko.com/api/v3/coins/markets',
            GLOBAL_DATA: 'https://api.coingecko.com/api/v3/global',
            COIN_LIST: 'https://api.coingecko.com/api/v3/coins/list'
        };
        
        // Real-time user assets (保持不变)
        const initialUserAssets = [
            { id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', balance: 0.8245, price: 0 },
            { id: 'ethereum', symbol: 'eth', name: 'Ethereum', balance: 4.28, price: 0 },
            { id: 'tether', symbol: 'usdt', name: 'Tether', balance: 5820.40, price: 1.00 },
            { id: 'cardano', symbol: 'ada', name: 'Cardano', balance: 1500.50, price: 0 },
            { id: 'solana', symbol: 'sol', name: 'Solana', balance: 25.75, price: 0 },
            { id: 'ripple', symbol: 'xrp', name: 'XRP', balance: 1200.80, price: 0 }
        ];
        
        // ==================== DASHBOARD INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CryptoWallet Dashboard Initialized');
            
            // 初始化所有模块 (你原有的逻辑)
            initSidebar(); // 注意：这个现在来自common/js/sidebar.js
            initBalanceSection();
            initWalletActions();
            initMarketData();
            initActivitySection();
            initLanguageSwitcher();
            initLogout();
            initPagination();
            
            // 加载初始数据
            loadMarketData();
            updateAllBalances();
            
            // 启动自动刷新
            startMarketDataAutoRefresh();
        });

        // ==================== 你原有的所有函数保持不变 ====================
        // 包括：loadMarketData, updateUserAssetsWithMarketPrices, 
        // initBalanceSection, updateAllBalances, initWalletActions,
        // initMarketData, renderMarketDataPage, 等等...
        // 我只是移除了那些现在放在common/js/utils.js中的通用函数
        
        // 例如，showToast函数现在应该从Utils调用：
        // 替换原来的 showToast('消息', 'success') 为：
        // Utils.showToast('消息', 'success')
        
        // ==================== 需要修改的调用点示例 ====================
        function loadMarketData() {
            try {
                // 使用Utils中的showToast
                Utils.showToast('Loading live market data...', 'info');
                
                // ... 你原有的API调用逻辑 ...
                
                Utils.showToast('Market data loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Error loading market data:', error);
                Utils.showToast('Failed to load market data. Using simulated data.', 'error');
                loadSimulatedMarketData();
            }
        }
        
        // 其他所有函数都保持原样...
        // 只需要把原来内联的通用函数调用改为 Utils.xxx() 即可
        
    </script>
</body>
</html>
